/**
 * LeetCode 2755. Deep Merge of Two Objects
 *
 * –£—Å–ª–æ–≤–∏–µ:
 * –î–∞–Ω—ã –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è obj1 –∏ obj2, –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏—Ö –≥–ª—É–±–æ–∫–æ–π —Å–ª–∏—è–Ω–∏—è.
 *
 * –ü—Ä–∞–≤–∏–ª–∞ –≥–ª—É–±–æ–∫–æ–≥–æ —Å–ª–∏—è–Ω–∏—è:
 * - –ï—Å–ª–∏ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –æ–±—ä–µ–∫—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π –æ–±—ä–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∫–ª—é—á–∏ –∏–∑ –æ–±–æ–∏—Ö.
 *   ‚Ä¢ –ï—Å–ª–∏ –∫–ª—é—á –µ—Å—Ç—å –≤ –æ–±–æ–∏—Ö –æ–±—ä–µ–∫—Ç–∞—Ö, –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–∏–≤–∞—é—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ.  
 *   ‚Ä¢ –ò–Ω–∞—á–µ –∫–ª—é—á –∏ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
 *
 * - –ï—Å–ª–∏ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –º–∞—Å—Å–∏–≤—ã, —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π –º–∞—Å—Å–∏–≤ –∏–º–µ–µ—Ç –¥–ª–∏–Ω—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–ª–∏–Ω–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞.
 *   ‚Ä¢ –≠–ª–µ–º–µ–Ω—Ç—ã –ø–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∏–Ω–¥–µ–∫—Å–∞–º —Å–ª–∏–≤–∞—é—Ç—Å—è –ø–æ —Ç–µ–º –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º, —á—Ç–æ –∏ –æ–±—ä–µ–∫—Ç—ã.
 *   ‚Ä¢ –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –∏–∑ –º–∞—Å—Å–∏–≤–æ–≤, –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
 *
 * - –í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö (—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã, –ø—Ä–∏–º–∏—Ç–∏–≤—ã –∏ —Ç.–ø.) —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è obj2.
 *
 * –ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ:
 * obj1 –∏ obj2 –ø–æ–ª—É—á–µ–Ω—ã —á–µ—Ä–µ–∑ JSON.parse(), —Ç–æ –µ—Å—Ç—å —ç—Ç–æ –≤–∞–ª–∏–¥–Ω—ã–µ JSON-–∑–Ω–∞—á–µ–Ω–∏—è.
 *
 * –ü—Ä–∏–º–µ—Ä—ã:
 * 1) obj1 = { "a": 1, "c": 3 }, obj2 = { "a": 2, "b": 2 }
 *    –†–µ–∑—É–ª—å—Ç–∞—Ç: { "a": 2, "c": 3, "b": 2 }
 *
 * 2) obj1 = [{}, 2, 3], obj2 = [[], 5]
 *    –†–µ–∑—É–ª—å—Ç–∞—Ç: [[], 5, 3]
 *
 * 3) obj1 = {
 *       "a": 1,
 *       "b": { "c": [1, [2, 7], 5], "d": 2 }
 *    },
 *    obj2 = {
 *       "a": 1,
 *       "b": { "c": [6, [6], [9]], "e": 3 }
 *    }
 *    –†–µ–∑—É–ª—å—Ç–∞—Ç:
 *    {
 *      "a": 1,
 *      "b": {
 *        "c": [6, [6, 7], [9]],
 *        "d": 2,
 *        "e": 3
 *      }
 *    }
 *
 * 4) obj1 = true, obj2 = null
 *    –†–µ–∑—É–ª—å—Ç–∞—Ç: null
 *
 * –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
 * - 1 <= JSON.stringify(obj1).length <= 5 * 10^5
 * - 1 <= JSON.stringify(obj2).length <= 5 * 10^5
 */


function deepMerge(obj1, obj2) {
  // –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è ¬´–Ω–∞—Å—Ç–æ—è—â–∏–º¬ª –æ–±—ä–µ–∫—Ç–æ–º,
  // –º—ã –Ω–µ –º–æ–∂–µ–º —Å–ª–∏—Ç—å –∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º obj2, –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è—è obj1.
  if (!isObject(obj1) || !isObject(obj2)) return obj2;

  // –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª–∏—è–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ –∏ –æ–±—ä–µ–∫—Ç–∞: –µ—Å–ª–∏ –æ–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –º–∞—Å—Å–∏–≤, –∞ –¥—Ä—É–≥–æ–π –Ω–µ—Ç,
  // –Ω–µ—Ç –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –æ—Ç–¥–∞–µ–º –≤—Ç–æ—Ä–æ–π –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
  if (Array.isArray(obj1) !== Array.isArray(obj2)) return obj2;

  // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º _–≤—Å–µ_ –ø–µ—Ä–µ—á–∏—Å–ª–∏–º—ã–µ –∫–ª—é—á–∏ obj2.
  for (const key in obj2) {
    // –§–∏–ª—å—Ç—Ä—É–µ–º —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:
    // –±–µ—Ä—ë–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π hasOwnProperty –∏–∑ Object.prototype –∏ –≤—ã–∑—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ call.
    // –ü—Ä–∏—á–∏–Ω—ã:
    //  - obj2 –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ hasOwnProperty,
    //    –∏ –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ obj2.hasOwnProperty(key) –¥–∞—Å—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
    //  - obj2 –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ Object.create(null),
    //    —Ç–æ–≥–¥–∞ —É –Ω–µ–≥–æ –≤–æ–æ–±—â–µ –Ω–µ—Ç –º–µ—Ç–æ–¥–∞ hasOwnProperty.
    // –í—ã–∑–æ–≤ Object.prototype.hasOwnProperty.call –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç
    // –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ωo–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞.
    //
    // –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
    //   Object.hasOwn(obj2, key)
    if (!Object.prototype.hasOwnProperty.call(obj2, key)) continue;

    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞ –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–∫—É—Ä—Å–∏—é:
    //  - –ï—Å–ª–∏ obj1[key] –∏ obj2[key] ‚Äî –æ–±—ä–µ–∫—Ç—ã/–º–∞—Å—Å–∏–≤—ã, –º—ã —Å–ø—É—Å–∫–∞–µ–º—Å—è –≥–ª—É–±–∂–µ.
    //  - –ò–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º obj1[key] –∑–Ω–∞—á–µ–Ω–∏–µ–º obj2[key].
    obj1[key] = deepMerge(obj1[key], obj2[key]);
  }

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π obj1, —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞.
  return obj1;
}

function isObject(value) {
  // JavaScript: typeof null —Ç–æ–∂–µ ¬´object¬ª, –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º != null.
  return typeof value === 'object' && value !== null;
}








// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è assert, –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—â–∞—è –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ.
function assert(condition, message) {
  if (!condition) {
    throw new Error(message);
  }
}

/*
  –¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ deepMerge.
  –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —ç—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
  –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è deepMerge(obj1, obj2).
*/
const tests = [
  {
    description: "–ü—Ä–æ—Å—Ç–æ–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ: –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞",
    async test() {
      const obj1 = { a: 1, b: 2 };
      const obj2 = { b: 3, c: 4 };
      const result = deepMerge(obj1, obj2);
      const expected = { a: 1, b: 3, c: 4 };

      assert(
        JSON.stringify(result) === JSON.stringify(expected),
        `–û–∂–∏–¥–∞–ª–æ—Å—å ${JSON.stringify(expected)}, –ø–æ–ª—É—á–µ–Ω–æ ${JSON.stringify(result)}`
      );

      // obj1 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑–º–µ–Ω—ë–Ω —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ result
      assert(
        JSON.stringify(obj1) === JSON.stringify(expected),
        "obj1 –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–∏—è–Ω–∏—è"
      );
    }
  },

  {
    description: "–ó–∞–º–µ–Ω–∞ –Ω–µ-–æ–±—ä–µ–∫—Ç–Ω–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç",
    async test() {
      const obj1 = { x: 10 };
      const obj2 = { x: { y: 5 } };
      const result = deepMerge(obj1, obj2);
      const expected = { x: { y: 5 } };

      assert(
        JSON.stringify(result) === JSON.stringify(expected),
        `–û–∂–∏–¥–∞–ª–æ—Å—å ${JSON.stringify(expected)}, –ø–æ–ª—É—á–µ–Ω–æ ${JSON.stringify(result)}`
      );
    }
  },

  {
    description: "–ì–ª—É–±–æ–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤",
    async test() {
      const obj1 = { a: { b: 1 } };
      const obj2 = { a: { c: 2 } };
      const result = deepMerge(obj1, obj2);
      const expected = { a: { b: 1, c: 2 } };

      assert(
        JSON.stringify(result) === JSON.stringify(expected),
        `–û–∂–∏–¥–∞–ª–æ—Å—å ${JSON.stringify(expected)}, –ø–æ–ª—É—á–µ–Ω–æ ${JSON.stringify(result)}`
      );
    }
  },

  {
    description: "–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –º–∞—Å—Å–∏–≤–∞ –∏ –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–µ –∏–∑ obj2",
    async test() {
      const obj1 = { arr: [1, 2, 3] };
      const obj2 = { arr: { 0: "zero", 1: "one" } };
      const result = deepMerge(obj1, obj2);
      const expected = { arr: { 0: "zero", 1: "one" } };

      assert(
        JSON.stringify(result) === JSON.stringify(expected),
        `–û–∂–∏–¥–∞–ª–æ—Å—å ${JSON.stringify(expected)}, –ø–æ–ª—É—á–µ–Ω–æ ${JSON.stringify(result)}`
      );
    }
  },

  {
    description: "–¢–æ–ø-—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Å–ª–∏—è–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º obj2",
    async test() {
      const obj1 = 42;
      const obj2 = { answer: 42 };
      const result = deepMerge(obj1, obj2);
      const expected = { answer: 42 };

      assert(
        JSON.stringify(result) === JSON.stringify(expected),
        `–û–∂–∏–¥–∞–ª–æ—Å—å ${JSON.stringify(expected)}, –ø–æ–ª—É—á–µ–Ω–æ ${JSON.stringify(result)}`
      );
    }
  },

  {
    description: "–ì–ª—É–±–æ–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ –º–∞—Å—Å–∏–≤–æ–≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø–∞",
    async test() {
      const arr1 = [1, 2, 3];
      const arr2 = [4, 5];
      const result = deepMerge(arr1, arr2);
      const expected = [4, 5, 3];

      assert(
        Array.isArray(result),
        "–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º"
      );
      assert(
        JSON.stringify(result) === JSON.stringify(expected),
        `–û–∂–∏–¥–∞–ª–æ—Å—å ${JSON.stringify(expected)}, –ø–æ–ª—É—á–µ–Ω–æ ${JSON.stringify(result)}`
      );
    }
  },

  {
    description: "–°–ª–∏—è–Ω–∏–µ null —Å –æ–±—ä–µ–∫—Ç–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç",
    async test() {
      const obj1 = null;
      const obj2 = { foo: "bar" };
      const result = deepMerge(obj1, obj2);
      const expected = { foo: "bar" };

      assert(
        JSON.stringify(result) === JSON.stringify(expected),
        `–û–∂–∏–¥–∞–ª–æ—Å—å ${JSON.stringify(expected)}, –ø–æ–ª—É—á–µ–Ω–æ ${JSON.stringify(result)}`
      );
    }
  },

  {
    description: "–°–ª–æ–∂–Ω–∞—è –≤–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã",
    async test() {
      const obj1 = { a: [{ b: 1 }, { c: 2 }] };
      const obj2 = { a: [{ b: 3 }, { d: 4 }, { e: 5 }] };
      const result = deepMerge(obj1, obj2);
      const expected = {
        a: [
          { b: 3 },
          { c: 2, d: 4 },
          { e: 5 }
        ]
      };

      assert(
        JSON.stringify(result) === JSON.stringify(expected),
        `–û–∂–∏–¥–∞–ª–æ—Å—å ${JSON.stringify(expected)}, –ø–æ–ª—É—á–µ–Ω–æ ${JSON.stringify(result)}`
      );
    }
  }
];

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤.
(async () => {
  console.log("–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è deepMerge...");
  let hasErrors = false;

  for (let i = 0; i < tests.length; i++) {
    try {
      await tests[i].test();
      console.log(`‚úîÔ∏è  –¢–µ—Å—Ç ${i + 1} –ø—Ä–æ–π–¥–µ–Ω: ${tests[i].description}`);
    } catch (e) {
      hasErrors = true;
      console.error(`‚ùå –¢–µ—Å—Ç ${i + 1} –Ω–µ –ø—Ä–æ–π–¥–µ–Ω: ${tests[i].description}`);
      console.error(e); // –≤—ã–≤–æ–¥–∏–º —Å–∞–º—É –æ—à–∏–±–∫—É —Å –µ—ë —Å—Ç–µ–∫–æ–º
    }
  }

  if (hasErrors) {
    console.error("‚ùó –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π.");
  } else {
    console.log("üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –¥–ª—è deepMerge –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ.");
  }
})();
